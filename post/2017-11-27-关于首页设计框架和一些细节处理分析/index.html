<!DOCTYPE html>
<html>
  <head>
      
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- 百度验证 -->
<meta name="baidu-site-verification" content="1IkquSGR9Z"/>

<title>君赏博客</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<meta name="description" content="2012年从事iOS开发，资深iOS开发菜鸟，目前在环球易购占坑。喜欢研究偏门技术，喜欢自动化编程，喜欢研究小软件提高编程效率"/>
<meta name="keywords" content="2012年从事iOS开发，资深iOS开发菜鸟，目前在环球易购占坑。喜欢研究偏门技术，喜欢自动化编程，喜欢研究小软件提高编程效率"/>

<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
<link rel="shortcut icon" href="https://joserccblog.github.io/favicon.ico">

<link rel="stylesheet" href="https://joserccblog.github.io/styles/main.css">

<!-- Modernizr JS -->
<script src="https://joserccblog.github.io/media/scripts/_vendors/modernizr-2.6.2.min.js"></script>
<!-- FOR IE9 below -->
<!--[if lt IE 9]>
<scripts src="https://joserccblog.github.io/media/scripts/_vendors/respond.min.js"></scripts>
<![endif]-->

<!-- Comment -->

    

    
        <link rel="stylesheet" href="https://unpkg.com/disqusjs@1.1/dist/disqusjs.css" />
    


<script src="https://cdn.bootcss.com/highlight.js/9.15.8/highlight.min.js"></script>

<link crossorigin="anonymous" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" href="https://lib.baomitu.com/font-awesome/5.8.1/css/all.min.css" rel="stylesheet">

  </head>
  <body>
  
<div id="fh5co-offcanvas">
    <a href="#!" class="fh5co-close-offcanvas js-fh5co-close-offcanvas">
        <span><i class="icon-cross3"></i> <span>Close</span></span>
    </a>
    <div class="fh5co-bio">
        <figure>
            <img src="https://joserccblog.github.io/media/images/avatar.png" alt="君赏博客" class="img-responsive">
        </figure>
        <h3 class="heading">ABOUT ME</h3>
        <h2>君赏博客</h2>
        <p>2012年从事iOS开发，资深iOS开发菜鸟，目前在环球易购占坑。喜欢研究偏门技术，喜欢自动化编程，喜欢研究小软件提高编程效率</p>
        <ul class="fh5co-social">
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
        </ul>
    </div>

    <div class="fh5co-menu">
        <div class="fh5co-box">
            <h3 class="heading">搜索</h3>
            <form action="#">
                <div class="form-group">
                    <input type="text" id="bdcsMain" class="form-control" placeholder="输入关键字">
<!--                    <button type="submit" class="btn btn-sm btn-warning" style="margin-top: 6px; width: 100%">点击搜索</button>-->
                </div>
            </form>
        </div>
        <div class="fh5co-box">
            <h3 class="heading">标签</h3>
            <ul>
                
                    <li><a href="https://joserccblog.github.io/tag/ilTRbUeIh">OCUI</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/qFaqD3-EnQ">链式语法</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/swift">Swift</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/ios">iOS</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/framework">Framework</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/carthage">Carthage</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/cocoapods">Cocoapods</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/masonry">Masonry</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/yue-shu-chong-tu">约束冲突</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/uistackview">UIStackView</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/ios11">iOS11</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/sheng-huo">生活</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/zhi-shi-dian">知识点</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/testflight">TestFlight</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/guo-ji-hua">国际化</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/xcode9">Xcode9</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/zi-dong-hua">自动化</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/hei-mo-fa">黑魔法</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/ota">OTA</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/xctest">XCTest</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/appstore">AppStore</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/mac">Mac</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/gan-xiang">感想</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/xcode">Xcode</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/svn">SVN</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/xiang-fa">想法</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/di-san-fang-ku">第三方库</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/mo-kuai-hua">模块化</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/c">C</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/autolayout">AutoLayout</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/xib">Xib</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/clang-format">Clang Format</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/objetive-c">Objetive-C</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/zhou-bao">周报</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/jekyll">Jekyll</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/server">Server</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/uibarbuttonitem">UIBarButtonItem</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/uitextfiled">UITextFiled</a></li>
                
            </ul>
        </div>
    </div>
</div>

<header id="fh5co-header">
    <div class="container-fluid">
        <div class="row">
            <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
            <ul class="fh5co-social">
                
                    <li>
                        <a href="/"
                         >
                            首页
                        </a>
                    </li>
                
                    <li>
                        <a href="/archives"
                         >
                            归档
                        </a>
                    </li>
                
                    <li>
                        <a href="/tags"
                         >
                            标签
                        </a>
                    </li>
                
                    <li>
                        <a href="/post/about"
                         >
                            关于
                        </a>
                    </li>
                
                    <li>
                        <a href="/post/contact/"
                         >
                            联系作者
                        </a>
                    </li>
                
            </ul>
            <div class="col-lg-12 col-md-12 text-center">
                <h1 id="fh5co-logo">
                    <a href="https://joserccblog.github.io">君赏博客 </a>
                </h1>
            </div>
        </div>
    </div>
</header>


<!--  <a href="#" class="fh5co-post-prev"><span>👈 Prev</span></a>-->
<!--  <a href="#" class="fh5co-post-next"><span>Next 👉</span></a>-->

  <div class="container-fluid">
      <div class="row fh5co-post-entry single-entry">
          <article class="col-lg-8 col-lg-offset-2 col-md-8 col-md-offset-2 col-sm-8 col-sm-offset-2 col-xs-12 col-xs-offset-0">
              <figure class="animate-box">
                  
                      <img src="http://ipicimage-1251019290.coscd.myqcloud.com/2017-11-27-030613.jpg" alt="关于首页设计框架和一些细节处理分析" class="img-responsive">
                  
              </figure>
              <span class="fh5co-meta animate-box">
                  
                      <div class="tag-container">
                          
                              <a href="https://joserccblog.github.io/tag/ios" class="tag">iOS, </a>
                          
                      </div>
                  
              </span>
              <h2 class="fh5co-article-title animate-box">关于首页设计框架和一些细节处理分析</h2>
              <span class="fh5co-meta fh5co-date animate-box">2017-11-27</span>

              <div class="col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0 col-xs-12 col-xs-offset-0 text-left content-article">
                  <div class="row">
                      <div class="col-md-12 animate-box post-content">
                          <p> <p>关于首页设计框架和一些细节处理分析</p>
<p>下面是首页界面预览图</p>
<p><img src="http://upload-images.jianshu.io/upload_images/545662-35b9c5e985e94474.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>第一部分</p>
<p><img src="http://upload-images.jianshu.io/upload_images/545662-1e5ed1d695052a38.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>这个一个横向的 Banner</p>
</blockquote>
<ul>
<li>高度随着后台返回尺寸自动自适应</li>
<li>如果返回的 Banner 数组为空则隐藏</li>
</ul>
<p>第二部分</p>
<p><img src="http://upload-images.jianshu.io/upload_images/545662-7dff50588810705e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>这是放置广告位的 设计说目前也就四个 我为了以后可以扩展 就做成如果超出四个就可以横向滚动</p>
</blockquote>
<ul>
<li>按钮的高度随着后台返回尺寸自动自适应</li>
<li>如果返回的元素都没有则隐藏这一栏</li>
</ul>
<p>第三部分</p>
<p><img src="http://upload-images.jianshu.io/upload_images/545662-5d18fbab55ea0e7d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>推荐预售和限时限量的商品 可以横向滚动 出现 ViewMore 跳转到对应频道的页面</p>
</blockquote>
<ul>
<li>切换频道可以切换对应栏目的内容</li>
<li>如果两者都没有数据隐藏</li>
</ul>
<p>第四部分</p>
<p><img src="http://upload-images.jianshu.io/upload_images/545662-6dda7681250d52e7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>四个广告位</p>
</blockquote>
<ul>
<li>广告位宽度位屏幕一半</li>
<li>如果四个都没有就隐藏</li>
<li>如果只有两个就显示两个</li>
</ul>
<p>第五部分</p>
<p><img src="http://upload-images.jianshu.io/upload_images/545662-e10a42cac36c311e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>显示促销的商品</p>
</blockquote>
<ul>
<li>栏目可以左右滑动切换</li>
<li>每一个栏目只有两个商品</li>
<li>倒计时结束就不显示</li>
</ul>
<p>第六部分</p>
<p><img src="http://upload-images.jianshu.io/upload_images/545662-10afb5580a16bbc6.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>显示首页的推荐商品</p>
</blockquote>
<ul>
<li>栏目可以左右切换</li>
<li>下面栏目列表可以滑动切换</li>
</ul>
<p>下面是做这个界面的心酸经历：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/545662-71025c767aa989da.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>开始觉得很简单，毕竟我也是对于 UITableView和 UICollectionView 很溜的码农。</p>
<p>之前界面框架很简单</p>
<p><img src="http://upload-images.jianshu.io/upload_images/545662-d637652fb6ddf794.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>整体是一个 UICollectionView</p>
<p>上面是一个 Header</p>
<p>我现在使用原来框架面临的问题是</p>
<ul>
<li>我的 Header 那么多元素 都超出两屏幕了 自然要滚动了 之前是商品列表和 Header 可以显示在一个屏幕</li>
<li>我下面的商品列表可以切换频道  之前不可以切换</li>
</ul>
<p>自己当时尝试写了1.0的框架 后来无法满足我们设计这个界面需求 废弃了</p>
<p>我就从 Github 找了几个开源库，看到他们的首页我们的很相似 开始我是这样的</p>
<p><img src="http://upload-images.jianshu.io/upload_images/545662-6d1c15681999b28e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>后来我用这个库换成我们首页</p>
<p><img src="http://upload-images.jianshu.io/upload_images/545662-a780e87b2b28ae33.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>我们的 Header 是很高的呀 完全行不通呀</p>
<p>后来继续找了几个库 添加 删除</p>
<p>那几天把我折腾的 差点要封掉</p>
<p>后来终于找到了一个第三方 可以满足90%的需求 只是底部又是会多出40高度 滚动无法联动 bug</p>
<p>后来觉得首页是 APP 的门户 这些小问题会影响我开发形象 遇到我决定</p>
<p><img src="http://upload-images.jianshu.io/upload_images/545662-602f8f01a085d34e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>去他大爷的，就给了几天时间做，我都来来回回做了快三个星期了，找框架就用了很久。</p>
<p>结果还是要自己写框架。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/545662-3e0e67ea6b80fb5c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>首页用到了 N 个 UICollectionView 你说6不6</p>
<p><img src="http://upload-images.jianshu.io/upload_images/545662-a6855b7f4561b86d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><strong>1 上面Header为啥用 UITableView？</strong></p>
<p>因为显示内容不是固定的 就用自己写的一个库</p>
<p><a href="https://github.com/josercc/ZHTableViewGroup">ZHTableViewGroup专门为复杂表格的解决方案</a></p>
<p><strong>2 下面是用的 ZHSegmentTagView(还没有托管在 Github)不过大家可以找类似的。为什么不和上面的模块放在TableView 里面？</strong></p>
<p>因为放在 TableView 随着滚动会刷新表格 对象会重新生成 很难和下面的频道页面联动</p>
<p><strong>3 为什么整体不用 UICollectionView 上面是 Header?</strong></p>
<p>因为下面的频道是横向滚动的 设置方向之后 UICollectionView 的 Header 就是在最左边 不是我们要的结果</p>
<p><img src="http://upload-images.jianshu.io/upload_images/545662-e68267a8768b979b.gif?imageMogr2/auto-orient/strip" alt=""></p>
<p>这是之前没做任何处理 显示的结果 导致下面的频道还没有在最上面时候 滚动下面 导致上面无法联动走了。</p>
<p>最后就做了判断 如果频道栏目没有在最上面 则强行设置下面滚动试图 ContentOffSet为{0,0}</p>
<p>把滑动的距离代理出去 让最外层的滚动试图做对应的滚动</p>
<p><img src="http://upload-images.jianshu.io/upload_images/545662-1b13f3c7adece4e4.gif?imageMogr2/auto-orient/strip" alt=""></p>
<p>现在自己做了处理 终于达到了联动的效果了</p>
<p><strong>4 上拉剩下10个商品时候要做 预加载请求</strong></p>
<p>发现因为每次 reloadData 都会让滚动的位置回到之前的位置。</p>
<p>发现每次刷新对象改变了 所以每次刷新数据 会回到初始位置</p>
<p>我就用字典保存对应频道 UICollectionView 的对象 每次刷新 取对象进行刷新</p>
<p>发现左右切换频道之后 再次回来 位置再次不是之前位置</p>
<p>发现 UICollectionView 重用机制 0和2位置公用同一个 导致0会记录2的位置 导致每次2到0频道0位置会变</p>
<p>最后用变量记录对应频道位置 判断如果当前频道刷新数据位置和之前记录不一样 则滚动到对应位置</p>
<blockquote>
<p>以后有时间 把首页的框架封装出来 方便以后类似界面使用。</p>
</blockquote>
 </p>
                      </div>
                  </div>

                  <div class="row">
                      <div class="col-md-12 animate-box">
                          
                              <div class="next-post">
                                  <div class="next">下一篇</div>
                                  <a href="https://joserccblog.github.io/post/2017-11-27-hq移动20170218期周报">
                                      <h3 class="post-title">
                                          HQ移动20170218期周报
                                      </h3>
                                  </a>
                              </div>
                          
                      </div>
                  </div>

                  <div class="row">
                      <div class="col-md-12 animate-box">
                          
                              

                              
                                  <div id="disqus_thread"></div>
                              
                          
                      </div>
                  </div>
              </div>

          </article>
      </div>
  </div>

    
<footer id="fh5co-footer">
  <p>Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a></p>
</footer>


    <!-- jQuery -->
<script src="https://joserccblog.github.io/media/scripts/_vendors/jquery.min.js"></script>
<!-- jQuery Easing -->
<script src="https://joserccblog.github.io/media/scripts/_vendors/jquery.easing.1.3.js"></script>
<!-- Bootstrap -->
<script src="https://joserccblog.github.io/media/scripts/_vendors/bootstrap.min.js"></script>
<!-- Waypoints -->
<script src="https://joserccblog.github.io/media/scripts/_vendors/jquery.waypoints.min.js"></script>
<!-- Main JS -->
<script src="https://joserccblog.github.io/media/scripts/_vendors/main.js"></script>
<!-- Md5 Min JS -->
<script src="https://joserccblog.github.io/media/scripts/_vendors/md5.min.js"></script>

<script type="application/javascript">
    hljs.initHighlightingOnLoad();
</script>



    

    
        <script src="https://unpkg.com/disqusjs@1.1/dist/disqus.js"></script>
        <script>

            var options = {
                shortname: 'josercc',
                apikey: 'DBJHHPsqZBT5EUYFyQmorAozkwxTDoySOnd4bmdt9G29YFySUFhFE6SLZrSCHee4',
            }
            if ('') {
                options.api = ''
            }
            var dsqjs = new DisqusJS(options)

        </script>
    




  </body>
</html>
