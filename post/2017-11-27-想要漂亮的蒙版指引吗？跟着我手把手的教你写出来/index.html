<!DOCTYPE html>
<html>
  <head>
      
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- ç™¾åº¦éªŒè¯ -->
<meta name="baidu-site-verification" content="1IkquSGR9Z"/>

<title>å›èµåšå®¢</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<meta name="description" content="2012å¹´ä»äº‹iOSå¼€å‘ï¼Œèµ„æ·±iOSå¼€å‘èœé¸Ÿï¼Œç›®å‰åœ¨ç¯çƒæ˜“è´­å å‘ã€‚å–œæ¬¢ç ”ç©¶åé—¨æŠ€æœ¯ï¼Œå–œæ¬¢è‡ªåŠ¨åŒ–ç¼–ç¨‹ï¼Œå–œæ¬¢ç ”ç©¶å°è½¯ä»¶æé«˜ç¼–ç¨‹æ•ˆç‡"/>
<meta name="keywords" content="2012å¹´ä»äº‹iOSå¼€å‘ï¼Œèµ„æ·±iOSå¼€å‘èœé¸Ÿï¼Œç›®å‰åœ¨ç¯çƒæ˜“è´­å å‘ã€‚å–œæ¬¢ç ”ç©¶åé—¨æŠ€æœ¯ï¼Œå–œæ¬¢è‡ªåŠ¨åŒ–ç¼–ç¨‹ï¼Œå–œæ¬¢ç ”ç©¶å°è½¯ä»¶æé«˜ç¼–ç¨‹æ•ˆç‡"/>

<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
<link rel="shortcut icon" href="https://joserccblog.github.io/favicon.ico">

<link rel="stylesheet" href="https://joserccblog.github.io/styles/main.css">

<!-- Modernizr JS -->
<script src="https://joserccblog.github.io/media/scripts/_vendors/modernizr-2.6.2.min.js"></script>
<!-- FOR IE9 below -->
<!--[if lt IE 9]>
<scripts src="https://joserccblog.github.io/media/scripts/_vendors/respond.min.js"></scripts>
<![endif]-->

<!-- Comment -->

    

    
        <link rel="stylesheet" href="https://unpkg.com/disqusjs@1.1/dist/disqusjs.css" />
    


<script src="https://cdn.bootcss.com/highlight.js/9.15.8/highlight.min.js"></script>

<link crossorigin="anonymous" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" href="https://lib.baomitu.com/font-awesome/5.8.1/css/all.min.css" rel="stylesheet">

  </head>
  <body>
  
<div id="fh5co-offcanvas">
    <a href="#!" class="fh5co-close-offcanvas js-fh5co-close-offcanvas">
        <span><i class="icon-cross3"></i> <span>Close</span></span>
    </a>
    <div class="fh5co-bio">
        <figure>
            <img src="https://joserccblog.github.io/media/images/avatar.png" alt="å›èµåšå®¢" class="img-responsive">
        </figure>
        <h3 class="heading">ABOUT ME</h3>
        <h2>å›èµåšå®¢</h2>
        <p>2012å¹´ä»äº‹iOSå¼€å‘ï¼Œèµ„æ·±iOSå¼€å‘èœé¸Ÿï¼Œç›®å‰åœ¨ç¯çƒæ˜“è´­å å‘ã€‚å–œæ¬¢ç ”ç©¶åé—¨æŠ€æœ¯ï¼Œå–œæ¬¢è‡ªåŠ¨åŒ–ç¼–ç¨‹ï¼Œå–œæ¬¢ç ”ç©¶å°è½¯ä»¶æé«˜ç¼–ç¨‹æ•ˆç‡</p>
        <ul class="fh5co-social">
            
                <li>
                    
                        <a href="https://github.com/josercc" target="_blank">
                            <i class="fab fa-github"></i>
                        </a>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                        <a href="https://weibo.com/kuaiqiantong" target="_blank">
                            <i class="fab fa-weibo"></i>
                        </a>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
        </ul>
    </div>

    <div class="fh5co-menu">
        <div class="fh5co-box">
            <h3 class="heading">æœç´¢</h3>
            <form action="#">
                <div class="form-group">
                    <input type="text" id="bdcsMain" class="form-control" placeholder="è¾“å…¥å…³é”®å­—">
<!--                    <button type="submit" class="btn btn-sm btn-warning" style="margin-top: 6px; width: 100%">ç‚¹å‡»æœç´¢</button>-->
                </div>
            </form>
        </div>
        <div class="fh5co-box">
            <h3 class="heading">æ ‡ç­¾</h3>
            <ul>
                
                    <li><a href="https://joserccblog.github.io/tag/swift">Swift</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/ios">iOS</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/framework">Framework</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/carthage">Carthage</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/cocoapods">Cocoapods</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/masonry">Masonry</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/yue-shu-chong-tu">çº¦æŸå†²çª</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/uistackview">UIStackView</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/ios11">iOS11</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/sheng-huo">ç”Ÿæ´»</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/zhi-shi-dian">çŸ¥è¯†ç‚¹</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/testflight">TestFlight</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/guo-ji-hua">å›½é™…åŒ–</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/xcode9">Xcode9</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/zi-dong-hua">è‡ªåŠ¨åŒ–</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/hei-mo-fa">é»‘é­”æ³•</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/ota">OTA</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/xctest">XCTest</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/appstore">AppStore</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/mac">Mac</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/gan-xiang">æ„Ÿæƒ³</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/xcode">Xcode</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/svn">SVN</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/xiang-fa">æƒ³æ³•</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/di-san-fang-ku">ç¬¬ä¸‰æ–¹åº“</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/mo-kuai-hua">æ¨¡å—åŒ–</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/c">C</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/autolayout">AutoLayout</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/xib">Xib</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/clang-format">Clang Format</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/objetive-c">Objetive-C</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/zhou-bao">å‘¨æŠ¥</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/jekyll">Jekyll</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/server">Server</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/uibarbuttonitem">UIBarButtonItem</a></li>
                
                    <li><a href="https://joserccblog.github.io/tag/uitextfiled">UITextFiled</a></li>
                
            </ul>
        </div>
    </div>
</div>

<header id="fh5co-header">
    <div class="container-fluid">
        <div class="row">
            <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
            <ul class="fh5co-social">
                
                    <li>
                        <a href="/"
                         >
                            é¦–é¡µ
                        </a>
                    </li>
                
                    <li>
                        <a href="/archives"
                         >
                            å½’æ¡£
                        </a>
                    </li>
                
                    <li>
                        <a href="/tags"
                         >
                            æ ‡ç­¾
                        </a>
                    </li>
                
                    <li>
                        <a href="/post/about"
                         >
                            å…³äº
                        </a>
                    </li>
                
                    <li>
                        <a href="/post/contact/"
                         >
                            è”ç³»ä½œè€…
                        </a>
                    </li>
                
            </ul>
            <div class="col-lg-12 col-md-12 text-center">
                <h1 id="fh5co-logo">
                    <a href="https://joserccblog.github.io">å›èµåšå®¢ </a>
                </h1>
            </div>
        </div>
    </div>
</header>


<!--  <a href="#" class="fh5co-post-prev"><span>ğŸ‘ˆ Prev</span></a>-->
<!--  <a href="#" class="fh5co-post-next"><span>Next ğŸ‘‰</span></a>-->

  <div class="container-fluid">
      <div class="row fh5co-post-entry single-entry">
          <article class="col-lg-8 col-lg-offset-2 col-md-8 col-md-offset-2 col-sm-8 col-sm-offset-2 col-xs-12 col-xs-offset-0">
              <figure class="animate-box">
                  
                      <img src="http://ipicimage-1251019290.coscd.myqcloud.com/2017-11-27-074438.jpg" alt="æƒ³è¦æ¼‚äº®çš„è’™ç‰ˆæŒ‡å¼•å—ï¼Ÿè·Ÿç€æˆ‘æ‰‹æŠŠæ‰‹çš„æ•™ä½ å†™å‡ºæ¥" class="img-responsive">
                  
              </figure>
              <span class="fh5co-meta animate-box">
                  
                      <div class="tag-container">
                          
                              <a href="https://joserccblog.github.io/tag/ios" class="tag">iOS, </a>
                          
                      </div>
                  
              </span>
              <h2 class="fh5co-article-title animate-box">æƒ³è¦æ¼‚äº®çš„è’™ç‰ˆæŒ‡å¼•å—ï¼Ÿè·Ÿç€æˆ‘æ‰‹æŠŠæ‰‹çš„æ•™ä½ å†™å‡ºæ¥</h2>
              <span class="fh5co-meta fh5co-date animate-box">2017-11-27</span>

              <div class="col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0 col-xs-12 col-xs-offset-0 text-left content-article">
                  <div class="row">
                      <div class="col-md-12 animate-box post-content">
                          <p> <p>æœ€è¿‘ç‰ˆæœ¬çš„ä¸€ä¸ªéœ€æ±‚æ˜¯ç»™é¦–é¡µæ·»åŠ æ–°äººè’™ç‰ˆï¼Œç±»ä¼¼çš„æ•ˆæœå›¾å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><strong>é¦–é¡µç¬¬ä¸€å±‚è’™ç‰ˆçš„æ•ˆæœå›¾</strong></p>
<p><img src="http://upload-images.jianshu.io/upload_images/545662-c90dd6f8e25f8af9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é¦–é¡µè’™å±‚"></p>
<p><strong>é¦–é¡µç¬¬äºŒå±‚çš„è’™ç‰ˆæ•ˆæœå›¾</strong></p>
<p><img src="http://upload-images.jianshu.io/upload_images/545662-3760d05d85f1d5af.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é¦–é¡µè’™å±‚2"></p>
<p><strong>ä¸ªäººä¸­å¿ƒçš„è’™ç‰ˆæ•ˆæœå›¾</strong></p>
<p><img src="http://upload-images.jianshu.io/upload_images/545662-2cac899c38c495bf.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç”¨æˆ·ä¸­å¿ƒè’™å±‚"></p>
<blockquote>
<p>å…¶å®æˆ‘è§‰å¾—è¿™äº›æ–°äººå¼•å¯¼å®Œå…¨æ˜¯æ²¡å¿…è¦çš„ï¼Œå¯¹äºä¸€ä¸ªçŸ¥é“ç”¨ APP ä¹°ä¸œè¥¿çš„ç”¨æˆ·æ€ä¹ˆçœ‹ä¸æ˜ç™½è¿™äº›æ ‡å¿—ï¼Œè¿˜è¦ç”¨è’™ç‰ˆå¼•å¯¼å‘Šè¯‰ä»–ã€‚</p>
</blockquote>
<p>æ—¢ç„¶æ¥åˆ°äº†è¿™ä¸ªéœ€æ±‚ï¼Œé‚£ä¹ˆå°±éœ€è¦åšå‡ºæ¥ï¼Œç¬¬ä¸€çœ¼çœ‹ä¸Šå»ç¡®å®æœ‰ç‚¹éš¾ã€‚å½“æ—¶å®‰å“å·²ç»æ‰¾åˆ°äº†å¯¹åº”çš„åº“ï¼Œååˆ†å®¹æ˜“çš„åšè¿™ä¸ªéœ€æ±‚äº†ã€‚</p>
<p>æˆ‘å½“æ—¶çš„ç¬¬ä¸€ä¸ªæƒ³æ³•æ˜¯ï¼Œæ—¢ç„¶å®‰å“æœ‰ç±»ä¼¼çš„åº“ï¼Œé‚£ä¹ˆ <code>iOS</code>åº”è¯¥ä¹Ÿæœ‰ç±»ä¼¼çš„åº“ã€‚æˆ‘å½“å³å°±åœ¨æœ€å¤§çš„æˆäººåŒæ€§äº¤å‹ç½‘ç«™ <code>GitHub</code> æŸ¥æ‰¾å¯¹åº”å…³é”®è¯å»æ‰¾å¯¹åº”çš„è’™ç‰ˆæŒ‡å¼•çš„åº“ã€‚</p>
<p>è™½ç„¶æ˜¯æ‰¾åˆ°äº†ï¼Œä½†æ˜¯è¢«åˆ«äºº <code>Star</code>çš„æ˜Ÿå¾ˆå°‘ï¼Œæˆ–è€…æ˜¯æœ‰å‡ ç™¾çš„ä¸‹è½½å‡ºæ¥è¿è¡Œ<code>Demo</code> å°±å´©æºƒäº†ï¼Œå¯¼è‡´æˆ‘ç¬¬ä¸€æ—¶é—´ä¸¥é‡æ€€ç–‘è¿™ä¸ªåº“çš„å¥å£®æ€§ã€‚</p>
<p>æ—¢ç„¶æ²¡æœ‰æ‰¾åˆ°å¯ä»¥ä¿¡èµ–çš„è½®å­ï¼Œé‚£å°±è‡ªå·±ç ”ç©¶ä¸€ä¸‹ï¼Œæ¯•ç«Ÿä¹‹å‰æ²¡æœ‰åšè¿‡ã€‚ä¹‹å‰ä¸€è‡´è§‰å¾—ä¸­é—´é•‚ç©ºçš„æ˜¯ç”¨å‘¨å›´å¾ˆå¤šå—ä¸éœ²ç©ºçš„ç»„åˆåœ¨ä¸€èµ·å½¢æˆçš„ï¼Œæ‰€ä»¥å¾ˆå¤æ‚çš„é•‚ç©ºæˆ‘éƒ½è§‰å¾—å¾ˆéš¾å¼„ã€‚</p>
<p>è¿™ä¸ªéœ€æ±‚æˆ‘ä¹‹å‰çš„æƒ³æ³•ä¸€å®šæ˜¯åšä¸å‡ºæ¥çš„ï¼Œå°±ç™¾åº¦ä¸€ä¸‹è’™ç‰ˆæŒ‡å¼•çš„åšæ³•ã€‚åœ¨ç®€ä¹¦ä¸Šé¢çœ‹åˆ°ä¸€ä¸ªå‰è¾ˆå†™çš„æ•™ç¨‹ï¼Œåªæœ‰æ€ä¹ˆåšå‡ºæ¥çš„éƒ¨åˆ†å…³é”®çš„ä»£ç ï¼Œæ˜¯æ²¡æœ‰ä¾‹å­çš„ã€‚</p>
<p>é‚£ä¸ªå‰è¾ˆè¯´ï¼Œæƒ³é—®ä»–è¦ä¾‹å­æ˜¯æ²¡æœ‰çš„ï¼Œå¦‚æœæƒ³è¦ï¼Œè‡ªå·±å°±åŠ¨æ‰‹å†™ä¸€ä¸ªã€‚æˆ‘è§‰å¾—è¿™ä¸ªå‰è¾ˆè¯´çš„å¾ˆå°‘ï¼Œåªæœ‰è‡ªå·±äº²æ‰‹å†™ä¸€ä¸ªæ‰å¯ä»¥ç†è§£çš„æ›´æ·±ã€‚</p>
<p>ç»è¿‡æŸ¥è¯¢ï¼Œæˆ‘æ‰¾åˆ°äº†åšè¿™ä¸ªåŠŸèƒ½ä¸€ä¸ªé‡è¦çš„å±æ€§ã€‚</p>
<pre><code class="language-objective-c">@property(nullable, strong) CALayer *mask;
</code></pre>
<p>è¿™ä¸ªå±æ€§è§£é‡Šçš„é€šä¿—æ˜“æ‡‚å°±æ˜¯å…¶ä»–çš„ <code>CALayer</code> æ˜¯æ·»åŠ åˆ°å“ªé‡Œï¼Œé‚£é‡Œå°±ä¸æ˜¾ç¤ºã€‚è¿™ä¸ª <code>mask</code> çš„ <code>CALayer</code> æ˜¯æ·»åŠ åˆ°å“ªé‡Œï¼Œé‚£é‡Œå°±å¯ä»¥æ˜¾ç¤ºå‡ºæ¥ã€‚</p>
<p>æ—¢ç„¶æœ‰äº†è¿™ä¸ªå±æ€§ï¼Œé‚£ä¹ˆå°±å¥½åŠå¤šäº†ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿä¸Šé¢çš„ä¸‰å¼ æ•ˆæœå›¾ï¼Œäº‰å–æ‰¾åˆ°æœ€å¤šçš„å…±åŒç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥å°è£…ä¸€ä¸ªç»„ä»¶ï¼Œç”¨äºæ”¯æŒæˆ‘ä»¬ä¸‰å¼ è’™ç‰ˆæŒ‡å¼•ã€‚</p>
<p><strong>å‘ç°çš„å…±åŒç‚¹</strong></p>
<ul>
<li>æœ‰ä¸€ä¸ªå…¨å±çš„åŠé€æ˜çš„è’™ç‰ˆè¯•å›¾</li>
<li>æ¯ä¸€ä¸ªæŒ‡å¼•æœ‰ä¸€ä¸ªé€æ˜çš„åœˆ(ä¸ç®¡æ˜¯æ¤­åœ†è¿˜æ˜¯åœ†å½¢)</li>
<li>æ¯ä¸€ä¸ªåœˆå¤–é¢éƒ½æœ‰ä¸€ä¸ªè™šçº¿åœˆ</li>
<li>æ¯ä¸€ä¸ªæŒ‡å¼•éƒ½æœ‰ä¸€ä¸ªæŒ‡å¼•å‰ªå¤´</li>
<li>æ¯ä¸€ä¸ªæŒ‡å¼•éƒ½æœ‰ä¸€æ®µæŒ‡å¼•çš„æ–‡å­—</li>
</ul>
<p><strong>å‘ç°çš„ä¸åŒç‚¹</strong></p>
<ul>
<li>æ¤­åœ†æˆ–è€…æ˜¯åœ†å½¢</li>
<li>æœ‰æŒ‰é’®æˆ–è€…æ²¡æŒ‰é’®</li>
</ul>
<blockquote>
<p>æ­¤å¤„æˆ‘å°±è¦åæ§½ä¸€ä¸‹è¿™ä¸ªè®¾è®¡äº¤äº’ã€‚æˆ‘ä»¬å‘ç°æœ€åä¸€ä¸ªæ˜¯æ²¡æœ‰æŒ‰é’®çš„ï¼Œé‚£ä¹ˆæ„å‘³ç€æˆ‘ä»¬ç‚¹å‡»ä»»ä½•åœ°æ–¹å°±å¯ä»¥è®©è’™ç‰ˆæ¶ˆå¤±ã€‚</p>
<p>å¦‚æœç‚¹å‡»ä»»ä½•åœ°æ–¹å°±å¯ä»¥è®©è’™ç‰ˆæ¶ˆå¤±ï¼Œé‚£ä¹ˆé¦–é¡µçš„ä¸¤å¼ è’™ç‰ˆä¸Šé¢çš„æŒ‰é’®çœŸçš„æœ‰ä¿ç•™çš„æ„ä¹‰äº†ã€‚</p>
<p>å¦‚æœåªå…è®¸ä¸ªäººä¸­å¿ƒçš„è’™ç‰ˆå¯ä»¥ç‚¹å‡»ä»»ä½•åœ°æ–¹æ¶ˆå¤±ï¼Œé‚£ä¹ˆè¿™ä¸ªéœ€æ±‚çš„äº¤äº’å°±ä¸ç»Ÿä¸€äº†ã€‚æœ€åæ˜¯ä¸‰å¼ è’™ç‰ˆç‚¹å‡»ä»»ä½•åœ°æ–¹éƒ½æ¶ˆå¤±</p>
</blockquote>
<p>æˆ‘ä»¬å¯ä»¥æŠŠç›¸åŒçš„åœ°æ–¹åšæˆä¸€ä¸ªåŸºç±»ï¼Œä¸åŒçš„åœ°æ–¹å¯ä»¥åœ¨å¯¹åº”çš„å­ç±»è¿›è¡Œä¿®æ”¹å³å¯ã€‚</p>
<p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç»§æ‰¿äº <code>UIView</code> çš„ç±»åå­—å«åš<code>GBBaseMaskView</code>ç±»ç”¨äºå°è£…æˆ‘ä»¬æŒ‡å¼•çš„å…±åŒç‚¹ã€‚</p>
<p>æˆ‘ä»¬è®¾ç½®å­ç±»è¯•å›¾çš„èƒŒæ™¯é¢œè‰²ä¸ºé»‘è‰² 0.8é€æ˜</p>
<pre><code class="language-objective-c">self.backgroundColor = [UIColor colorWithWhite:0 alpha:0.8];
</code></pre>
<p>å› ä¸ºæˆ‘ä»¬çš„æŒ‡å¼•ç›®å‰åªæœ‰ä¸¤ç§ï¼Œé‚£å°±æ˜¯æ¤­åœ†å’ŒåŸå‹ã€‚æˆ‘ä»¬å°±è®¾ç½®ä¸€ä¸ªæšä¸¾ç”¨äºåŒºåˆ†è¿™ä¸¤ç§ç±»å‹ã€‚</p>
<pre><code class="language-objective-c">/**
 * åˆ›å»ºè’™ç‰ˆçš„ç±»å‹

 - GBMaskItemStyleCircle: åœ†å½¢
 - GBMaskItemStyleOval: æ¤­åœ†
 */
typedef NS_ENUM(NSUInteger, GBMaskItemStyle) {
    
    GBMaskItemStyleCircle,
    GBMaskItemStyleOval,
};
</code></pre>
<p>æˆ‘ä»¬ç»™ <code>UIView</code> æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œç”¨äºç‚¹å‡»å¯ä»¥è®©è’™ç‰ˆæ¶ˆå¤±ã€‚</p>
<pre><code class="language-objective-c">@weakify(self);
[self addTapGestureWithComplete:^(UIView * _Nonnull view) {
    @strongify(self);
    [self actionButtonClick];
}];
</code></pre>
<p>æ­¤å¤„æˆ‘ä»¬ç”¨åˆ°çš„æ˜¯æˆ‘ä»¬åŸºäº <code>UIView</code> å†™çš„ä¸€ä¸ªå¿«æ·æ·»åŠ ç‚¹å‡»äº‹ä»¶çš„åˆ†ç±»æ–¹æ³•ã€‚</p>
<pre><code class="language-objective-c">- (void)addTapGestureWithComplete:(UIViewGestureComplete)complete {
    NSParameterAssert(complete);
    self.userInteractionEnabled = YES;
    UITapGestureRecognizer *tapGesture = [[UITapGestureRecognizer alloc]initWithTarget:self action:@selector(tapClick)];
    objc_setAssociatedObject(self, @selector(tapGesture), tapGesture, OBJC_ASSOCIATION_RETAIN_NONATOMIC);
    objc_setAssociatedObject(self, @selector(tapGestureComplete), complete, OBJC_ASSOCIATION_COPY_NONATOMIC);
    [self addGestureRecognizer:tapGesture];
}

#pragma mark - gesture method
- (void)tapClick{
    self.tapGestureComplete(self);
}

#pragma mark - property get
- (nullable UITapGestureRecognizer *)tapGesture {
    return objc_getAssociatedObject(self,_cmd);
}

- (UIViewGestureComplete)tapGestureComplete {
    return objc_getAssociatedObject(self, _cmd);
}
</code></pre>
<p>ä¸ºäº†è®©ç•Œé¢æ¶ˆå¤±ä¹‹å‰ï¼Œä¼ é€’ç•Œé¢æ¶ˆå¤±çš„ä¿¡æ¯ç»™å¤–ç•Œï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªç”¨äºå¼‚æ­¥å›è°ƒçš„ Block</p>
<pre><code class="language-objective-c">/**
 * æ“ä½œæŒ‰é’®çš„å›è°ƒ
 */
@property (nonatomic, copy) void(^actionCompletionHandle)(void);
</code></pre>
<p>é‚£ä¹ˆæˆ‘ä»¬åœ¨<code>actionButtonClick</code>æ–¹æ³•å®ç°å¦‚ä¸‹ã€‚</p>
<pre><code class="language-objective-c">- (void)actionButtonClick {
    if (self.actionCompletionHandle) {
        self.actionCompletionHandle();
    }
    [self removeFromSuperview];
}
</code></pre>
<p>è¿™ä¸ªç±»ä¼¼äº <code>Alert</code>å’Œ <code>Sheet</code>å¼¹æ¡†çš„æ–¹å¼ï¼Œæˆ‘ä»¬å°±å®šä¹‰ç±»ä¼¼çš„æ–¹æ³•å«åš <code>showInWindow</code>ç”¨äºå±•ç¤ºç•Œé¢ã€‚</p>
<pre><code class="language-objective-c">- (void)showInWindow {
    [self setupMakeMask];
    [GB_ROOT_WINDOWS addSubview:self];
}
</code></pre>
<p>æˆ‘ä»¬åœ¨è¿™ä¸ªæ–¹æ³•åˆ†åˆ«è°ƒç”¨äº† <code>setupMakeMask</code>å’Œç”¨äº† <code>GB_ROOT_WINDOWS</code>è¿™ä¸ªå®ã€‚ç°åœ¨æˆ‘ä»¬æŠ›å¼€ <code>setupMakeMask</code>ä¸è¯´ï¼Œå’±ä»¬å…ˆè¯´ä¸€ä¸‹ <code>GB_ROOT_WINDOWS</code>è¿™ä¸ªå®è¿™ä¸ªä¸­é—´æ›²æŠ˜çš„æ•…äº‹å§ã€‚</p>
<blockquote>
<p>æ•…äº‹æ˜¯è¿™æ ·å¼€å§‹çš„ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢çš„è¿æ¥ã€‚</p>
<p><a href="http://www.jianshu.com/p/116115583b55">ã€å·²è§£å†³ã€‘UIViewæ·»åŠ åˆ°KeyWindowä¸Šé¢è‡ªåŠ¨ä¼šè¢« Release</a></p>
<p>ğŸ˜‚å¿½ç•¥æˆ‘ <code>GB_ROOT_WINDOWS</code>å¤šä¸€ä¸ª <code>s</code>å•è¯çš„æ‰‹è¯¯å§ã€‚</p>
<p>æˆ‘ä»¬å½“æ—¶æ–°ä¸‹è½½è¿›å…¥é¦–é¡µçš„æ—¶å€™ä¼šå¼¹å‡ºå¾ˆå¤šçš„å¼¹æ¡†ğŸ˜€æ¯”å¦‚</p>
<ul>
<li>å¼ºåˆ¶æ›´æ–°æç¤º(åªæœ‰ APP æ— æ³•ä½¿ç”¨ å¾ˆå°‘å‡ºç°)</li>
<li>è’™ç‰ˆæç¤º(æ²¡æœ‰å¼¹å‡ºè’™ç‰ˆçš„æ‰å‡ºç°)</li>
<li>æ–°äººå¤§ç¤¼åŒ…(ä¸‰å¤©ä¸€æ¬¡)</li>
<li>æ³¨å†Œé€šçŸ¥ç¡®è®¤æ¡†</li>
<li>è¯„åˆ†å¼¹æ¡†</li>
<li>ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</li>
</ul>
<p>å¤§ä½“ä¸Šç›®å‰å°±æœ‰è¿™ä¹ˆå¤šï¼Œæ°å·§æ–°ç”¨æˆ·ä¸‹è½½å°±ä¼šå¼¹å‡º<strong>æ³¨å†Œé€šçŸ¥å¼¹å‡ºæ¡†</strong>ï¼Œ <strong>æ–°äººå¤§ç¤¼åŒ…å¼¹å‡ºæ¡†</strong>ï¼Œ <strong>æ–°äººè’™ç‰ˆæŒ‡å¼•å¼¹å‡ºæ¡†</strong>ã€‚</p>
<p>å½“æ—¶æ²¡æœ‰æ³¨æ„ <code>KeyWindow</code>è¿™ä¸ªç‚¹ï¼Œæ‰€ä»¥å°±è§‰å¾—å¦‚æœå…¨å±é”å®šå°± <code>addSubView</code>åˆ° <code>keyWindow</code>å°±å¯ä»¥äº†ã€‚</p>
<p>æ²¡æƒ³åˆ°<strong>æ–°äººè’™ç‰ˆæŒ‡å¼•</strong>ä¸éœ€è¦åå°åšæ§åˆ¶å°±ç›´æ¥å¯ä»¥æ‰§è¡Œä»£ç å±•ç¤ºã€‚ä½†æ˜¯ <strong>æ–°äººå¤§ç¤¼åŒ…</strong>éœ€è¦åå°æ§åˆ¶ï¼Œæ‰€ä»¥ä¼šåœ¨ç½‘ç»œå›è°ƒä¹‹åæ‰ä¼šæ‰§è¡Œå¼¹å‡ºæ“ä½œã€‚</p>
<p>å½“æ—¶å‡ºç°äº†è¿™ä¹ˆçš„ä¸€ä¸ªæƒ…å†µ</p>
<ul>
<li>å‡ºç° <strong>æ–°äººè’™ç‰ˆæŒ‡å¼•</strong> <strong>æ³¨å†Œé€šçŸ¥å¼¹å‡ºæ¡†</strong> <strong>æ–°äººå¤§ç¤¼åŒ…å¼¹å‡ºæ¡†</strong></li>
<li>å‡ºç° <strong>æ–°äººè’™ç‰ˆæŒ‡å¼•</strong> <strong>æ³¨å†Œé€šçŸ¥å¼¹å‡ºæ¡†</strong></li>
</ul>
<p>å¶å°”ä¼šå¼¹å‡ºæ¥æ–°äººå¤§ç¤¼åŒ…å¼¹å‡ºæ¡†ï¼Œå¼€å§‹æˆ‘ä»¥ä¸ºæ˜¯æ¥å£æ²¡æœ‰å›æ¥æ•°æ®ï¼Œå¯¼è‡´æ‰æ— æ³•æ˜¾ç¤ºå‡ºæ¥çš„ã€‚</p>
<p>åæ¥æµ‹è¯•è¯´<strong>å®‰å“</strong>çš„å°±å¯ä»¥æ˜¾ç¤ºå‡ºæ¥ï¼Œå°± <code>iOS</code>çš„ä¸å‡ºç°ã€‚æˆ‘æµ‹è¯•äº†æ¥å£æ˜¯æ­£å¸¸çš„ï¼Œé‚£ä¹ˆå°±æ˜¯å®¢æˆ·ç«¯çš„å½±å“äº†ã€‚</p>
<p>å½“æ—¶çš„ä¸€ä¸ªæƒ³æ³•æ˜¯ <code>è‹¹æœ</code>å¯¹äº <code>window</code>çš„è’™ç‰ˆæˆ–è®¸åšäº†é™åˆ¶ï¼Ÿå› ä¸ºé¦–é¡µè¿™æ ·ä¸€æ¬¡æ€§å‡ºç°è¿™ä¹ˆå¤šï¼Œä¼šä½“éªŒä¸å¥½æ‰è‡ªåŠ¨ä¼˜åŒ–å¸®æˆ‘ä»¬å»é™¤çš„ï¼Ÿ</p>
<p>æˆ‘é¡ºç€è¿™ä¸ªæƒ³æ³•å°±å»åšäº†æµ‹è¯•ç”¨ä¾‹ï¼Œæ³¨é‡Šäº† <code>æ–°äººè’™ç‰ˆæŒ‡å¼•</code>çš„å¼¹å‡ºæ¡†ã€‚å°±åªç•™ä¸‹ <code>æ–°äººå¤§ç¤¼åŒ…</code>å’Œ <code>æ³¨å†Œé€šçŸ¥çš„å¼¹å‡ºæ¡†</code>ã€‚</p>
<p>å¦‚æœæ¯æ¬¡éƒ½å‡ºç°ï¼Œå°±éªŒè¯äº†æˆ‘çš„çŒœæƒ³ã€‚</p>
<p>ç»“æœä¹Ÿæ˜¯å¶å°”ä¼šå‡ºç° <code>æ–°äººè’™ç‰ˆæŒ‡å¼•</code>ï¼Œå¤§éƒ¨åˆ†æµ‹è¯•ç”¨ä¾‹éƒ½ä¸ä¼šå¼¹å‡ºã€‚</p>
<p>å½“æ˜¯çœ‹äº†ä»£ç å†™æ³•éƒ½å¾ˆæ­£å¸¸ï¼Œå¹¶ä¸”ç±»ä¼¼çš„å†™æ³•åœ¨ <code>æ–°äººè’™ç‰ˆæŒ‡å¼•</code>çš„éœ€æ±‚ä¸Šå°±è¡¨ç°çš„å¾ˆæ­£å¸¸ï¼Œä¸ºä»€ä¹ˆåœ¨ <code>æ–°äººå¤§ç¤¼åŒ…</code>çš„éœ€æ±‚ä¸Šé¢å°±è¡¨ç°ä¸æ­£å¸¸ï¼Œæ—¶è€Œå‡ºç°æ—¶è€Œä¸å‡ºç°çš„ã€‚</p>
<p>æˆ‘æ„Ÿè§‰è¿™ä¸ªéœ€æ±‚çš„ç±»ä»£ç æœ‰æ¯’ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/545662-f08c58a06c8907a2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="A81BCCDC-F828-40D3-8A8F-0DD411C5BBBD"></p>
<p>åæ¥æˆ‘ç”¨ <code>Reveal</code>æŸ¥çœ‹è¯•å›¾åœ¨ä»€ä¹ˆä½ç½®çš„æ—¶å€™ï¼Œå‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯è¿™ä¸ªå¯¹è±¡æ ¹æœ¬æ²¡å‡ºç°ã€‚</p>
<p>å¦‚æœæ²¡å‡ºç°ï¼Œéš¾é“è¢«é‡Šæ”¾äº†ã€‚</p>
<p>äºæ˜¯æˆ‘åœ¨ <code>dealloc</code>çš„æ–¹æ³•æ·»åŠ äº† <code>Log</code>ä¿¡æ¯ï¼Œæœç„¶ç«Ÿç„¶èµ°äº† <code>dealloc</code>çš„æ–¹æ³•ã€‚</p>
<p>è™½ç„¶æˆ‘åˆ›å»ºçš„å±€éƒ¨å˜é‡ï¼Œä½†æ˜¯æˆ‘é€šè¿‡ <code>addSubView</code>æ–¹æ³•å·²ç»æ·»åŠ åˆ°è¯•å›¾ä¸Šé¢äº†ã€‚è¿˜è¢«é‡Šæ”¾ï¼Œæˆ‘è¯»ä¹¦å°‘ï¼Œä¸è¦éª—æˆ‘ã€‚</p>
<p>æˆ‘å¤§èƒ†çš„ç”¨äº†ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œè¿™æ ·æ€»ä¸ä¼šé‡Šæ”¾äº†å§ï¼Œæˆ‘çœ‹ä½ è¿˜ä¸å‡ºç°ã€‚</p>
<p>ç«Ÿç„¶ TMD è¿˜æ˜¯æ²¡å‡ºç°ï¼ï¼ï¼</p>
<p><img src="http://upload-images.jianshu.io/upload_images/545662-5884d042a5baecbf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="756EDF51-D681-4F3D-92BF-840EEDFA101B"></p>
<p>è¿™ç©¶ç«Ÿæ˜¯æ€ä¹ˆä¸ªæƒ…å†µï¼Œæœ€ååœ¨ç¾¤ä¸­å¾—åˆ°çš„ç­”å¤æ˜¯æˆ‘æ·»åŠ åœ¨ <code>keyWindow</code>æ˜¯å½“æ—¶å¼¹å‡ºæ¥çš„ <code>Alert</code>çš„ <code>æ³¨å†Œé€šçŸ¥çš„å¼¹å‡ºæ¡†</code>ã€‚</p>
<p>ä¹‹å <code>keyWindow</code>æ¢å›æ¥ä¹‹åï¼Œæˆ‘ä»¬çš„æ§ä»¶å°±è¢«ç§»é™¤ï¼Œä¹‹åå°±è¢«é‡Šæ”¾äº†ã€‚è®©æˆ‘ä»¬ç”¨ <code>AppDelegate</code>åˆ›å»ºçš„ <code>window</code>è¿™æ ·æ‰ä¿è¯ä¸ä¼šå‡ºé—®é¢˜ã€‚</p>
<p>å¬å®Œè§‰å¾—è¯´çš„å¾ˆæœ‰é“ç†ï¼Œå°±æ”¹äº†ä¸€ä¸‹ï¼Œæœç„¶è§£å†³äº†ã€‚</p>
<p>äº‹æƒ…åˆ°æ­¤å°±ç»“æŸäº†ï¼Œç°åœ¨æƒ³ä¸€ä¸‹ï¼Œåº”è¯¥æ˜¯æˆ‘ä»¬ <code>æ–°äººè’™ç‰ˆæŒ‡å¼•</code>æ²¡æœ‰ç»è¿‡ç½‘ç»œè¯·æ±‚ç¬é—´æ‰§è¡Œï¼Œå½“æ—¶æˆ‘ä»¬çš„ <code>keyWindow</code>è¿˜æ²¡æœ‰æ”¹å˜ï¼Œå½“ <code>æ–°äººå¤§ç¤¼åŒ…</code>ç½‘ç»œå›è°ƒä¹‹åã€‚æˆ‘ä»¬çš„ <code>keyWindow</code>å·²ç»æ”¹å˜äº†ã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆå¶å°”ä¼šå‡ºç°ï¼Œå¯èƒ½åŸå› æ˜¯æˆ‘ä»¬æ˜¯å†…å®¹ï¼Œå½“è¯·æ±‚è¶³å¤Ÿå¿«çš„æ—¶å€™ï¼Œå°±å¯ä»¥æ­£å¸¸çš„æ˜¾ç¤ºå‡ºæ¥ã€‚</p>
<p>ä½œä¸ºæœ€åï¼Œä¸ºäº†è¿™æ ·çš„é—®é¢˜ä¸ä¼šå†å‡ºç°ï¼Œå†™ä»£ç æœ€å¥½è§„èŒƒä¸€ç‚¹ç”¨ä¸‹é¢çš„å®ä»£æ›¿æˆ‘ä»¬å¸¸ç”¨çš„ <code>keyWindow</code>å³å¯ã€‚</p>
<pre><code class="language-objective-c">#define GB_ROOT_WINDOWS [[[UIApplication sharedApplication] delegate] window] // è·å–åº”ç”¨çš„çš„ Root Window
</code></pre>
</blockquote>
<p>ç°åœ¨å…³äº <code>GB_ROOT_WINDOWS</code>çš„æ¢—æˆ‘ä»¬å·²ç»å¬å®Œäº†ï¼Œæˆ‘ä»¬ç»§ç»­è®²è§£ <code>setupMakeMask</code>è¿™ä¸ªåˆå§‹åŒ–è’™å±‚çš„æ–¹æ³•ã€‚</p>
<pre><code class="language-objective-c">- (void)setupMakeMask {
    if ([self conformsToProtocol:@protocol(GBBaseMaskViewDataSource)]) {
        id&lt;GBBaseMaskViewDataSource&gt; dataSource = (id&lt;GBBaseMaskViewDataSource&gt;)self;
        _maskItems = [dataSource maskViewItems:self];
    }
    [self makeMask];
}
</code></pre>
<p>æˆ‘ä»¬çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œç”¨åˆ°äº†ä¸€ä¸ªä»£ç†æºç”¨äºè·å–éœ€è¦æ·»åŠ çš„è’™å±‚å¯¹è±¡ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹æˆ‘ä»¬å†™çš„ä»£ç†ã€‚</p>
<pre><code class="language-objective-c">@protocol GBBaseMaskViewDataSource&lt;NSObject&gt;
- (NSArray&lt;GBBaseMaskViewItem *&gt; *)maskViewItems:(GBBaseMaskView *)maskView;
@end
</code></pre>
<p>æˆ‘ä»¬çš„è’™å±‚æ•°æ®å¯¹è±¡åè®®å¾ˆç®€å•ï¼Œå°±æ˜¯è·å–ä¸€ä¸ªæ•°ç»„å³å¯ã€‚è¿™ä¸ª <code>GBBaseMaskViewItem</code>å¯¹è±¡æ˜¯ä»€ä¹ˆä¸œè¥¿å‘¢ï¼Ÿ</p>
<p>å½“æ—¶æ˜¯è¿™ä¹ˆæƒ³çš„ï¼Œå› ä¸ºé…ç½®ä¸€ä¸ªå¯¹è±¡å°±éœ€è¦å¾ˆå¤šçš„æ•°æ®ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªå°±åšæˆä¸€ä¸ªæ¨¡å‹ä¿ç•™æˆ‘ä»¬éœ€è¦çš„æ•°æ®ã€‚</p>
<p>è¿™æ ·æˆ‘ä»¬éœ€è¦çš„æ—¶å€™å°±åªéœ€è¦é…ç½®æˆ‘ä»¬çš„æ•°æ®æ¨¡å‹ï¼Œå°±ä¼šè‡ªåŠ¨ç”Ÿæˆæˆ‘ä»¬çš„è’™ç‰ˆã€‚</p>
<p>å› ä¸ºæˆ‘ä»¬çš„è’™ç‰ˆç±»å‹æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯ <code>åŸå‹</code>å’Œ <code>æ¤­åœ†å½¢</code>ã€‚</p>
<p><strong>å…³äºGBBaseMaskViewItemå¯¹è±¡è§£é‡Š</strong></p>
<p>é‚£ä¹ˆæˆ‘ä»¬å°±å†™ä¸€ä¸ª <code>GBMaskItemStyle</code>ç±»å‹çš„å˜é‡æ¥åŒºåˆ†åˆ°åº•æ˜¯ <code>æ¤­åœ†</code>è¿˜æ˜¯ <code>åŸå‹</code></p>
<pre><code class="language-objective-c">/**
 * è’™ç‰ˆé£æ ¼
 */
@property (nonatomic, assign) GBMaskItemStyle maskStyle;
</code></pre>
<p>æˆ‘ä»¬ç”»åœ†å½¢éœ€è¦ä¸¤ç‚¹ï¼Œä¸€ç‚¹å°±æ˜¯åŸå‹ï¼Œå¦å¤–å°±æ˜¯åŠå¾„ã€‚åªè¦æœ‰è¿™ä¸¤ç‚¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”»å‡ºä¸€ä¸ªåœ†ã€‚</p>
<pre><code class="language-objective-c">/**
 * åœ†å½¢çš„åœ†å¿ƒ
 */
@property (nonatomic, assign) CGPoint arcCenter;
/**
 * åœ†å½¢çš„åŠå¾„
 */
@property (nonatomic, assign) CGFloat radius;
</code></pre>
<p>å¯¹äºå‰ªå¤´å›¾ç‰‡çš„æ”¾ç½®ï¼Œæˆ‘å½“æ—¶é‡‡å–çš„æ–¹æ¡ˆæ˜¯ä¸‹é¢çš„ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/545662-c192b02bccefda1d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="13B4DAAE-EC53-4680-9DA0-3B5AB2D7C57F"></p>
<p>è¿™é‡Œé¢æœ‰ä¸‰ä¸ªé‡è¦çš„ç‚¹åˆ†åˆ«æ˜¯ <code>A</code>ç‚¹ <code>B</code>ç‚¹ <code>C</code>ç‚¹ã€‚</p>
<p>è¿™ä¸‰ä¸ªé‡è¦ç‚¹æ¥å¸®åŠ©æˆ‘ä»¬é…ç½®å’Œå®ç°æˆ‘ä»¬ä¸Šé¢çš„æ•ˆæœã€‚</p>
<p><code>A</code> ç‚¹æ˜¯æˆ‘ä»¬ç”»åœ†åœˆéœ€è¦çš„ä¸­å¿ƒç‚¹ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬éœ€è¦æŒ‰é’®æ§ä»¶çš„ä¸­å¿ƒç‚¹ã€‚åŠå¾„è¿™ä¸ªæˆ‘ä»¬å¯ä»¥è®¾ç½®ï¼Œè¿™ä¸ªåŠå¾„è·ç¦»å¤šå°‘ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®è®¾è®¡å›¾å¾®è°ƒå³å¯ã€‚</p>
<p><code>B</code>ç‚¹ä½œä¸ºå‰ªå¤´çš„åˆå§‹ç‚¹ï¼Œæˆ‘ä»¬è’™ç‰ˆä¸Šé¢çš„å‰ªå¤´æ˜¯è®© UI åˆ‡å‡ºæ¥çš„å›¾ç‰‡ã€‚å›¾ç‰‡æ˜¯ä¸­è§„ä¸­çŸ©çš„æ­£æ–¹å½¢ï¼Œæ‰€ä»¥æˆ‘ä»¬çŸ¥é“äº† <code>B</code>ç‚¹å’Œå›¾ç‰‡çš„å¤§å° å°±å¯ä»¥è®¡ç®—å‡º <code>C</code>ç‚¹çš„ä½ç½®</p>
<p>ä½†æ˜¯æˆ‘ä»¬æ€ä¹ˆçŸ¥é“ C ç‚¹çš„å…·ä½“ä½ç½®ï¼Œæˆ‘ä»¬å°±è¦å¼•å…¥ä¸€ä¸ªæ•°é‡åè¯ <code>è±¡é™</code>ã€‚</p>
<p>çŸ¥é“  <code>C</code>ç‚¹è·ç¦» <code>B</code>ç‚¹ä½äºé‚£ä¸ªè±¡é™ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ±‚å‡ºæ¥ <code>C</code>ç‚¹çš„åæ ‡ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”»å‡ºå‰ªå¤´çš„ä½ç½®æ‰€åœ¨ã€‚</p>
<p>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ–°çš„æšä¸¾ï¼Œç”¨äºæ ‡è¯†è±¡é™ã€‚</p>
<pre><code class="language-objective-c">/**
 * å‰ªå¤´è·ç¦»ä¸­å¿ƒçš„è±¡é™ä½ç½®

 - GBMaskItemQuadrant1: ç¬¬ä¸€è±¡é™
 - GBMaskItemQuadrant2: ç¬¬äºŒè±¡é™
 - GBMaskItemQuadrant3: ç¬¬ä¸‰è±¡é™
 - GBMaskItemQuadrant4: ç¬¬å››è±¡é™
 */
typedef NS_ENUM(NSUInteger, GBMaskItemQuadrant) {
    GBMaskItemQuadrant1,
    GBMaskItemQuadrant2,
    GBMaskItemQuadrant3,
    GBMaskItemQuadrant4,
};
</code></pre>
<blockquote>
<p>å½“æ—¶å¯èƒ½ä¸æ˜¯æŠŠå‰ªå¤´ä½œä¸ºä¸­å¿ƒç‚¹çš„ï¼Œæ‰€ä»¥å½“æ—¶è®¡ç®—å¯èƒ½æœ‰ç‚¹å‡ºå…¥ã€‚</p>
</blockquote>
<pre><code class="language-objective-c">/**
 * å‰ªå¤´è·ç¦»ä¸­å¿ƒç‚¹çš„è±¡é™
 */
@property (nonatomic, assign) GBMaskItemQuadrant arrowQuadrant;
</code></pre>
<p>æˆ‘ä»¬æ€ä¹ˆå®šä½ <code>B</code>çš„ä½ç½®ï¼Œå› ä¸ºç°åœ¨æˆ‘ä»¬åªçŸ¥é“ <code>A</code>ç‚¹çš„ä½ç½®ï¼Œæˆ‘ä»¬ä¸å¯èƒ½è®©ä½¿ç”¨çš„äººç»™å‡º <code>B</code>ç‚¹çš„ä½ç½®ï¼Œè¿™æ ·ä»¥åé€‚é…å¾ˆéº»çƒ¦ã€‚</p>
<p>æˆ‘ä»¬å°±å¼•å…¥äº†å«åš <code>åç§»é‡</code>ä¸œè¥¿ï¼Œæœ‰äº† <code>B</code>ç‚¹è·ç¦» <code>A</code>çš„åç§»é‡ï¼Œæˆ‘ä»¬è‡ªç„¶å°±å¯ä»¥æ±‚å‡º <code>B</code>çš„åæ ‡ã€‚</p>
<pre><code class="language-objective-c">/**
 * å‰ªå¤´è·ç¦»ä¸­å¿ƒåœ†çš„åç§»é‡
 */
@property (nonatomic, assign) CGPoint arrowOffset;
</code></pre>
<p>ä¸ºäº†æ±‚å‡º <code>C</code>ç‚¹æˆ‘ä»¬éœ€è¦çŸ¥é“å‰ªå¤´å›¾ç‰‡çš„å¤§å°ï¼Œè¿™ä¸ªæˆ‘ä»¬éƒ½å¯ä»¥é€šè¿‡ UI ç»™çš„å›¾ç‰‡çœ‹å‡ºæ¥ï¼Œè¿™ä¸ªè®¾ç½®ä¹Ÿæ˜¯ç®€å•çš„ã€‚</p>
<pre><code class="language-objective-c">/**
 * å‰ªå¤´çš„èŒƒå›´å¤§å°
 */
@property (nonatomic, assign) CGSize arrowSize;
</code></pre>
<p>æœ‰äº†è¿™ä¹ˆï¼Œå¦‚æœæ²¡æœ‰å›¾ç‰‡ï¼Œæˆ‘ä»¬æ€ä¹ˆæ˜¾ç¤ºå‡ºæ¥ã€‚æˆ‘ä»¬æ–°å»ºä¸€ä¸ªå›¾ç‰‡çš„å˜é‡ã€‚</p>
<pre><code class="language-objective-c">/**
 * å‰ªå¤´çš„å›¾ç‰‡
 */
@property (nonatomic, strong) UIImage *arrowImage;
</code></pre>
<p><img src="http://upload-images.jianshu.io/upload_images/545662-3d97ff27efc02b6b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="272AF3ED-89C5-43D0-A965-290F9B2FC0F9"></p>
<p>æˆ‘ä»¬å‰©ä¸‹çš„æ˜¯æ”¾ç½®æç¤ºçš„æ–‡æœ¬ã€‚æˆ‘ä»¬å‘ç°æ”¾ç½®æ–‡æœ¬åªå­˜åœ¨ä¸¤ç§æƒ…å†µï¼Œä¹Ÿä¹ˆåœ¨å‰ªå¤´å›¾ç‰‡çš„ä¸Šæ–¹ï¼Œè¦ä¹ˆåœ¨å‰ªå¤´å›¾ç‰‡çš„ä¸‹æ–¹ã€‚</p>
<p>æˆ‘ä»¬æ–°å»ºä¸€ä¸ªæšä¸¾ç”¨äºæ ‡è¯†ã€‚</p>
<pre><code class="language-objective-c">/**
 * ç®­å¤´æç¤ºæ–‡æœ¬åœ¨å‰ªå¤´çš„æ–¹å‘

 - GBMaskItemArrowTipPosiionTop: ä¸Šæ–¹
 - GBMaskItemArrowTipPosiionBottom: ä¸‹æ–¹
 */
typedef NS_ENUM(NSUInteger, GBMaskItemArrowTipPosition) {
    GBMaskItemArrowTipPositionTop,
    GBMaskItemArrowTipPositionBottom,
};
</code></pre>
<pre><code class="language-objective-c">#pragma mark - é…ç½®æç¤ºæ–‡æœ¬ä½ç½®
@property (nonatomic, assign) GBMaskItemArrowTipPosition tipPosition;
</code></pre>
<p>æˆ‘ä»¬æ–°å»ºä¸€ä¸ªå­—ç¬¦ä¸²å˜é‡èµ‹å€¼æ–‡æœ¬å†…å®¹</p>
<pre><code class="language-objective-c">/**
 * æç¤ºæ–‡æœ¬çš„å†…å®¹
 */
@property (nonatomic, copy) NSString *tipText;
</code></pre>
<p>æ•ˆæœå›¾æœ‰çš„æ–‡æœ¬å±…å·¦ï¼Œæœ‰çš„å±…å³ï¼Œæˆ‘ä»¬éœ€è¦è®©å¤–éƒ¨è®¾ç½®å¸ƒå±€æ–¹å¼</p>
<pre><code class="language-objective-c">/**
 * æ–‡æœ¬çš„å¯¹å…¶æ–¹å¼
 */
@property (nonatomic, assign) NSTextAlignment textAlignment;
</code></pre>
<p>æç¤ºæ–‡æœ¬å·²ç»ç¡®å®šå¥½äº†ï¼Œç°åœ¨å°±æ˜¯ä¸ªäººä¸­å¿ƒçš„è’™ç‰ˆ</p>
<p><img src="http://upload-images.jianshu.io/upload_images/545662-ddd3532cb01d9578.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="C5917E49-FF02-49FF-8AE7-EA7802935FDD"></p>
<p>ç»˜åˆ¶æ¤­åœ†æˆ‘ä»¬éœ€è¦çŸ¥é“è¿™ä¸ªæ¤­åœ†å¤–éƒ¨é•¿æ–¹å½¢çš„å¤§å°ï¼Œæˆ‘ä»¬æ–°åŠ ä¸‹é¢çš„å±æ€§ã€‚</p>
<pre><code class="language-objective-c">/**
 * ç»˜åˆ¶æ¤­åœ†çš„å¤§å°
 */
@property (nonatomic, assign) CGSize ovalSize;
</code></pre>
<p>æˆ‘ä»¬è¿˜éœ€è¦å¼€æ”¾æ–‡æœ¬å’Œå‰ªå¤´å›¾ç‰‡æ§ä»¶çš„è¯•å›¾</p>
<pre><code class="language-objective-c">/**
 * æç¤ºæ–‡æœ¬
 */
@property (nonatomic, strong, readonly) UILabel *tipLabel;
/**
 * å‰ªå¤´çš„å›¾ç‰‡
 */
@property (nonatomic, strong, readonly) UIImageView *arrowImageView;
</code></pre>
<pre><code class="language-objective-c">- (UILabel *)tipLabel {
    if (!_tipLabel) {
        _tipLabel = [[UILabel alloc] initWithFrame:CGRectZero];
        _tipLabel.textColor = [UIColor whiteColor];
        _tipLabel.font = [UIFont systemFontOfSize:14];
        _tipLabel.numberOfLines = 0;
    }
    return _tipLabel;
}

- (UIImageView *)arrowImageView {
    if (!_arrowImageView) {
        _arrowImageView = [[UIImageView alloc] initWithFrame:CGRectZero];
        _arrowImageView.contentMode = UIViewContentModeScaleAspectFit;
    }
    return _arrowImageView;
}
</code></pre>
<p>æˆ‘ä»¬çš„æ•°æ®æ¨¡å‹ç±»å·²ç»é…ç½®å®Œæ¯•ï¼Œç°åœ¨æˆ‘ä»¬è¦å¼€å§‹æˆ‘ä»¬æ­£å¸¸å¥‡å¦™ä¹‹æ—…äº†ã€‚</p>
<pre><code class="language-objective-c">- (void)makeMask {
  	// å¦‚æœæ²¡æœ‰é…ç½®æ•°æ® å°±å¯ä»¥ç›´æ¥è¿”å› ä»€ä¹ˆéƒ½ä¸åš
    if (_maskItems.count == 0) {
        return;
    }
  	 // ç»˜åˆ¶ä¸€ä¸ªæ•´ä¸ªå¤§å°çš„ç”»æ¿ ç”¨äºé˜²æ­¢é•‚ç©ºçš„è·¯å¾„
    UIBezierPath *path = [UIBezierPath bezierPathWithRect:self.bounds];
  	// ä¾¿åˆ©å¤–éƒ¨ä¼ å…¥çš„æ•°æ®æº
    [_maskItems enumerateObjectsUsingBlock:^(GBBaseMaskViewItem * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
        switch (obj.maskStyle) {
            // å¦‚æœæ˜¯åŸå‹ å°±ç»˜åˆ¶åœ†å½¢
            case GBMaskItemStyleCircle: {
                [path appendPath:[self addArcBezierPath:obj isDash:NO]];
            }
                break;
            // å¦‚æœæ˜¯æ¤­åœ† å°±ç»˜åˆ¶æ¤­åœ†
            case GBMaskItemStyleOval: {
                [path appendPath:[self addOvalBezierPath:obj isDask:NO]];
            }
                break;
            default:
                break;
        }
      	// æ·»åŠ å‰ªå¤´å›¾æ ‡
        [self addArrowImageInView:obj];
      	// æ·»åŠ æç¤ºæ–‡æœ¬
        [self addArrowTipLabel:obj];
    }];
  	// æ–°å»ºä¸€ä¸ªCAShapeLayerç”¨äºç»˜åˆ¶æˆ‘ä»¬çš„è·¯å¾„ åšé•‚ç©º
    CAShapeLayer *shapeLayer = [CAShapeLayer layer];
    shapeLayer.path = path.CGPath;
    self.layer.mask = shapeLayer;
}
</code></pre>
<p>ä¸Šé¢çš„ä»£ç å°±æ˜¯æˆ‘ä»¬è’™ç‰ˆç»˜åˆ¶çš„æ ¸å¿ƒã€‚</p>
<p>ä¸‹é¢æ˜¯ç»˜åˆ¶åœ†å½¢çš„æ–¹æ³•</p>
<p><img src="http://upload-images.jianshu.io/upload_images/545662-c60c3a990932c1c4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="A864B257-D350-4668-B663-F93715F03459"></p>
<pre><code class="language-objective-c">/*
* ç»˜åˆ¶ä¸€ä¸ªåœ†å½¢
* @param item é…ç½®çš„æ•°æ®æº
* @param isDash æ˜¯å¦éœ€è¦ç»˜åˆ¶è™šçº¿åœˆ ä¹Ÿå°±æ˜¯ä¸Šå›¾çš„æ‰€æŒ‡ç¤ºä½ç½®
*/
- (UIBezierPath *)addArcBezierPath:(GBBaseMaskViewItem *)item isDash:(BOOL)isDash {
  	// è®¾ç½®ç»˜åˆ¶çš„åœ†æ¯”æˆ‘ä»¬è®¾ç½®çš„å¤§3 å› ä¸ºæˆ‘ä»¬å¤–éƒ¨æ˜¯æŒ‰ç…§å›¾ç‰‡å°ºå¯¸è®¾ç½®çš„ æ‰€ä»¥éœ€è¦å¤§äº3 å®é™…æƒ…å†µä½ ä»¬å¯ä»¥è‡ªå·±å†³å®š
    CGFloat radius = item.radius + 3;
  	// å¦‚æœæ˜¯ç»˜åˆ¶è™šçº¿åœˆå°± è®©èŒƒå›´å¤§ä¸€äº›
    if (isDash) {
        radius += 4;
    }
    UIBezierPath *bezierPath = [UIBezierPath bezierPathWithArcCenter:item.arcCenter radius:radius startAngle:0 endAngle:2 * M_PI clockwise:NO];
    return bezierPath;
}
</code></pre>
<p>ä¸‹é¢æ˜¯ç»˜åˆ¶æ¤­åœ†çš„æ–¹æ³•</p>
<p><img src="http://upload-images.jianshu.io/upload_images/545662-ddd3532cb01d9578.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="C5917E49-FF02-49FF-8AE7-EA7802935FDD"></p>
<pre><code class="language-objective-c">/*
* ç»˜åˆ¶æ¤­åœ†å½¢
* @param item é…ç½®çš„æ•°æ®
* @param isDash æ˜¯å¦æ˜¯ç»˜åˆ¶å¤–å›´çš„è™šçº¿åœˆ
*/
- (UIBezierPath *)addOvalBezierPath:(GBBaseMaskViewItem *)item isDask:(BOOL)isDash {
  	// è®¾ç½®åç§»é‡ä¸º3
    CGFloat offSet = 3;
  	// å¦‚æœæ˜¯è™šçº¿åœˆå°±è®¾ç½®5 å¤§ä¸€äº›
    if (isDash) {
        offSet = 5;
    }
    CGRect rect = CGRectMake(item.arcCenter.x - item.ovalSize.width / 2.0 - offSet, item.arcCenter.y - item.ovalSize.height / 2.0 - offSet, item.ovalSize.width + offSet * 2, item.ovalSize.height + offSet * 2);
    UIBezierPath *bezierPath = [[UIBezierPath bezierPathWithOvalInRect:rect] bezierPathByReversingPath];
    return bezierPath;
}
</code></pre>
<p>æ·»åŠ å‰ªå¤´çš„å›¾ç‰‡</p>
<pre><code class="language-objective-c">/*
* æ·»åŠ å‰ªå¤´çš„å›¾ç‰‡åˆ°è¯•å›¾ä¸­
* @param item é…ç½®çš„æ•°æ®å¯¹è±¡
*/
- (void)addArrowImageInView:(GBBaseMaskViewItem *)item {
  	// å¦‚æœæ²¡æœ‰è®¾ç½®å›¾ç‰‡å°±ä¸è®¾ç½®
    if (!item.arrowImage) {
        return;
    }
  	// å¦‚æœæ²¡æœ‰è®¾ç½®å¤§å° ä¹Ÿä¸è®¾ç½®
    if (CGSizeEqualToSize(item.arrowSize, CGSizeZero)) {
        return;
    }
  	// æ ¹æ®ç»˜åˆ¶çš„ä¸­å¿ƒç‚¹å’Œåç§»é‡è®¡ç®—å‡º å‰ªå¤´ç‚¹çš„ä½ç½®åæ ‡
    CGPoint arrowPoint = CGPointMake(item.arcCenter.x + item.arrowOffset.x, item.arcCenter.y + item.arrowOffset.y);
  	// å‰ªå¤´ç‚¹åæ ‡å¯¹ç‚¹çš„åæ ‡å€¼
    CGFloat arrowCenterX, arrowCenterY;
  	// å› ä¸ºå‚è€ƒç‚¹æ˜¯å‰ªå¤´å›¾ç‰‡çš„ä¸­å¿ƒç‚¹ æ‰€ä»¥è®¡ç®—æ–¹æ³•å¦‚ä¸‹ å› ä¸ºå±å¹•çš„å€¼ä»ä¸Šåˆ°ä¸‹ ä»å·¦åˆ°å³ä¾æ¬¡å¢å¤§çš„ã€‚
    switch (item.arrowQuadrant) {
        // å¦‚æœæ˜¯ç¬¬ä¸€è±¡é™ X-W/2 Y+H/2
        case GBMaskItemQuadrant1: {
            arrowCenterX = arrowPoint.x - item.arrowSize.width / 2.0;
            arrowCenterY = arrowPoint.y + item.arrowSize.height / 2.0;
        }
            break;
        // å¦‚æœæ˜¯ç¬¬äºŒè±¡é™ X+W/2 Y+H/2
        case GBMaskItemQuadrant2: {
            arrowCenterX = arrowPoint.x + item.arrowSize.width / 2.0;
            arrowCenterY = arrowPoint.y + item.arrowSize.height / 2.0;
        }
            break;
        //å¦‚æœæ˜¯ç¬¬ä¸‰è±¡é™ X+W/2 Y-H/2
        case GBMaskItemQuadrant3: {
            arrowCenterX = arrowPoint.x + item.arrowSize.width / 2.0;
            arrowCenterY = arrowPoint.y - item.arrowSize.height / 2.0;
        }
            break;
        //å¦‚æœæ˜¯ç¬¬å››è±¡é™ X-W/2 Y-H/2
        case GBMaskItemQuadrant4: {
            arrowCenterX = arrowPoint.x - item.arrowSize.width / 2.0;
            arrowCenterY = arrowPoint.y - item.arrowSize.height / 2.0;
        }
            break;
        default:
            break;
    }
    item.arrowImageView.image = item.arrowImage;
    item.arrowImageView.frame = CGRectMake(0, 0, item.arrowSize.width, item.arrowSize.height);
    item.arrowImageView.center = CGPointMake(arrowCenterX, arrowCenterY);
    [self addSubview:item.arrowImageView];
}
</code></pre>
<p>æ·»åŠ æç¤ºæ–‡æœ¬</p>
<p><img src="http://upload-images.jianshu.io/upload_images/545662-ba3b7c1bdd8d00e5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="B28319B2-BFEC-4333-9F8A-2FA02C2E87A0"></p>
<pre><code class="language-objective-c">/*
* æ·»åŠ æç¤ºæ–‡æœ¬
* @param item é…ç½®çš„å¯¹è±¡
*/
- (void)addArrowTipLabel:(GBBaseMaskViewItem *)item {
  	// å¦‚æœæ²¡æœ‰è®¾ç½®æç¤ºæ–‡æœ¬å°±ä¸è®¾ç½®
    if (item.tipText.length == 0) {
        return;
    }
    item.tipLabel.text = item.tipText;
    item.tipLabel.textAlignment = item.textAlignment;
    [self addSubview:item.tipLabel];
  	// è®¾ç½®æç¤ºæ–‡æœ¬å¦‚ä¸Šå›¾çº¢çº¿åœˆæ‰€ç¤ºï¼Œå·¦ä¾§5 å³ä¾§5 å’Œå‰ªå¤´å›¾ç‰‡çš„è·ç¦»ä¸º5 ä¸‹é¢ä¸è®¾ç½®è‡ªé€‚åº” æ€ä¹ˆå¯ä»¥å½¢æˆä¸Šå›¾çš„ç»“æœå‘¢  æˆ‘ä»¬å¯ä»¥è®©æ–‡æœ¬æ·»åŠ \n æ¢è¡Œç¬¦å³å¯ã€‚
    [item.tipLabel mas_makeConstraints:^(MASConstraintMaker *make) {
        make.leading.mas_offset(10);
        make.trailing.mas_offset(-10);
        switch (item.tipPosition) {
            case GBMaskItemArrowTipPositionTop: {
                make.bottom.equalTo(item.arrowImageView.mas_top).offset(-5);
            }
                break;
            case GBMaskItemArrowTipPositionBottom: {
                make.top.equalTo(item.arrowImageView.mas_bottom).offset(5);
            }
                break;
            default:
                break;
        }
    }];
}
</code></pre>
<p>åˆ°æ­¤ä½ç½®æˆ‘ä»¬è™šçº¿åœˆè¿˜æ˜¯æ²¡æœ‰ç»˜åˆ¶å‡ºæ¥ï¼Œæˆ‘ä»¬åˆšæ‰çš„ä»£ç ä¸ºä»€ä¹ˆæ²¡æœ‰å‡ºç°è™šçº¿åœˆçš„ä»£ç ï¼Ÿ</p>
<p>é‚£æ˜¯å› ä¸ºå¦‚æœè®¾ç½®è™šçº¿åœˆï¼Œåˆ™æ˜¯é•‚ç©ºï¼Œæ— æ³•å‡ºç°è®¾è®¡å›¾çš„æ•ˆæœã€‚æˆ‘ä»¬éœ€è¦è¿›è¡Œç»˜åˆ¶ï¼Œåˆ™æ˜¯ç”¨åˆ°äº† <code>drawRect</code>æ–¹æ³•ã€‚</p>
<pre><code class="language-objective-c">- (void)drawRect:(CGRect)rect {
    [super drawRect:rect];
    [_maskItems enumerateObjectsUsingBlock:^(GBBaseMaskViewItem * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
        switch (obj.maskStyle) {
            // å¦‚æœæ˜¯åœ†ç±»å‹ å°±ç»˜åˆ¶åœ†å½¢è™šçº¿åœˆ
            case GBMaskItemStyleCircle: {
                [[self addDashInBezierPath:[self addArcBezierPath:obj isDash:YES]] fill];
            }
                break;
            // å¦‚æœæ˜¯æ¤­åœ†ç±»å‹ å°±ç»˜åˆ¶æ¤­åœ†å½¢è™šçº¿åœˆ
            case GBMaskItemStyleOval: {
                [[self addDashInBezierPath:[self addOvalBezierPath:obj isDask:YES]] fill];
            }
                break;
            default:
                break;
        }
    }];
}
</code></pre>
<p>æ·»åŠ è™šçº¿åœˆ</p>
<pre><code class="language-objective-c">- (UIBezierPath *)addDashInBezierPath:(UIBezierPath *)bezierPath {
    [[UIColor whiteColor] setStroke];
    bezierPath.lineWidth = 2;
    CGFloat dash[] = {3,3};
    [bezierPath setLineDash:dash count:2 phase:0];
    [bezierPath stroke];
    return bezierPath;
}
</code></pre>
<p>åˆ«é—®æˆ‘è¿™é‡Œé¢å€¼æ€ä¹ˆæ¥çš„ï¼Œæˆ‘ä¹Ÿæ˜¯é€šè¿‡ <code>PaintCode</code>è¿™ä¸ªè½¯ä»¶åšå‡ºæ¥ï¼Œå†è®¾ç½®çš„ã€‚å°±æ˜¯é€šè¿‡ä¸‹é¢çš„è½¯ä»¶ï¼Œä¸€ä¸ªå›¾å½¢ï¼Œæˆ–è€…æ˜¯åŠ¨ç”»å¯ä»¥ç”Ÿæˆä»£ç è½¯ä»¶ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/545662-1c2e706c6526585c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="93584A07-C604-45FA-9E3B-AEFDFA2C7655"></p>
<p>æ­¤æ—¶æˆ‘ä»¬å°è£…è’™ç‰ˆåŸºç±»å·²ç»å®Œæˆäº†ã€‚</p>
<p>å‰©ä¸‹å°±ååˆ†ç®€å•äº†ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ›å»ºä¸€ä¸ª <code>GBBaseMaskView</code>çš„å­ç±»ï¼Œå®ç° <code>GBBaseMaskViewDataSource</code>åè®®ï¼Œé…ç½®æˆ‘ä»¬éœ€è¦çš„æ•°æ®ã€‚</p>
<p>è¿˜æœ‰ä¸€ç‚¹å¿˜è®°è¯´æ˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨çˆ¶ç±»æ·»åŠ ä¸‹é¢æ–¹æ³•ï¼Œç”¨äºæŸ¥æ‰¾è¯•å›¾å¯¹åº”çˆ¶ç±»è¯•å›¾æ‰€åœ¨çš„ä¸­å¿ƒç‚¹ä½ç½®ã€‚</p>
<pre><code class="language-objective-c">- (CGPoint)convertCenterView:(UIView *)view {
    CGRect rect = [view convertRect:view.bounds toView:self];
    return CGPointMake(CGRectGetMidX(rect), CGRectGetMidY(rect));
}
</code></pre>
<p>è¿™æ ·æˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°ç•Œé¢ç»˜åˆ¶æŒ‰é’®æˆ–è€…è¯•å›¾å¯¹è±¡å³å¯ï¼Œè¿™æ ·ä¸ç”¨è€ƒè™‘ç•Œé¢å…¼å®¹ï¼Œå®Œå…¨æ˜¯è‡ªåŠ¨è®¡ç®—çš„ã€‚</p>
<p>åœ¨ç»“æŸæœ¬ç¯‡æ•™ç¨‹ä¹‹å‰ï¼Œè¿˜æœ‰ä¸€ä¸ªè¯´æ˜ç‚¹è¯´æ˜ä¸€ä¸‹ã€‚å¦‚æœé€šè¿‡ç³»ç»Ÿè‡ªå¸¦çš„æ–¹æ³•åˆ›å»º <code>UIBarButtonItem</code>æ˜¯æ— æ³•æ‰¾åˆ°å¯¹è±¡ï¼Œéœ€è¦æŸ¥æ‰¾å­è¯•å›¾ï¼Œå¹¶ä¸”åœ¨ <code>iOS11</code>ä¸Šé¢æ”¹äº†è¯•å›¾å±‚æ¬¡ã€‚</p>
<p><strong>é€šè¿‡æ ‡é¢˜æˆ–è€…æ˜¯å›¾ç‰‡è·å–å¯¼èˆªæ¡æŒ‰é’®çš„å¯¹è±¡</strong></p>
<pre><code>- (UIButton *)gb_barButtonWithTitle:(NSString *)title {
    return [self findBarButtonInView:self verify:^BOOL(UIButton *btn) {
        return [[btn titleForState:UIControlStateNormal] isEqualToString:title];
    }];
}

- (UIButton *)gb_barButtonWithImage:(UIImage *)image {
    return [self findBarButtonInView:self verify:^BOOL(UIButton *btn) {
        return btn.imageView.image.hash == image.hash;
    }];
}

- (UIButton *)findBarButtonInView:(UIView *)view verify:(BOOL(^)(UIButton *btn))verify {
    for (UIButton *btn in [self findAllButtonsInView:view]) {
        if (verify(btn)) {
            return btn;
        }
    }
    return nil;
}

- (NSArray&lt;UIButton *&gt; *)findAllButtonsInView:(UIView *)view {
    NSMutableArray&lt;UIButton *&gt; *buttons = [NSMutableArray array];
    [view.subviews enumerateObjectsUsingBlock:^(__kindof UIView * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
        if ([view isKindOfClass:[UIButton class]]) {
            [buttons addObject:(UIButton *)view];
        }
        [buttons addObjectsFromArray:[self findAllButtonsInView:obj]];
    }];
    return buttons;
}
</code></pre>
<p>è¿˜æœ‰å°±æ˜¯ <code>UITabBar</code>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹æ³•è·å–ã€‚</p>
<pre><code class="language-objective-c">- (UIImageView *)gb_tabbarItemTitle:(NSString *)title {
    __block UIImageView *imageView;
    [[self findAllBarButtonInView:self] enumerateObjectsUsingBlock:^(UIButton * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
        BOOL isNeedButton = NO;
        for (UIView *v in obj.subviews) {
            if ([v isKindOfClass:[UIImageView class]]) {
                imageView = (UIImageView *)v;
            }
            if ([v isKindOfClass:[UILabel class]]) {
                UILabel *label = (UILabel *)v;
                isNeedButton = [label.text isEqualToString:title];
            }
        }
        if (isNeedButton) {
            *stop = YES;
        }
    }];
    return imageView;
}

- (NSArray&lt;UIButton *&gt; *)findAllBarButtonInView:(UIView *)view {
    NSMutableArray *buttons = [NSMutableArray array];
    [view.subviews enumerateObjectsUsingBlock:^(__kindof UIView * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
        if ([view isKindOfClass:NSClassFromString(@&quot;UITabBarButton&quot;)]) {
            [buttons addObject:view];
        }
        [buttons addObjectsFromArray:[self findAllBarButtonInView:obj]];
    }];
    return buttons;
}
</code></pre>
<p>è¿™æ ·æˆ‘ä»¬è¿™ä¸ªéœ€æ±‚å°±åŸºæœ¬å®Œæˆäº†ï¼Œå‰©ä¸‹å°±æ˜¯é…ç½®æ•°æ®æºå°±å¯ä»¥å‡ºç°ã€‚å¦‚æœä»¥åå†æœ‰ç±»ä¼¼ç•Œé¢ï¼Œæˆ‘ä»¬åªç”¨æ–°å»ºä¸€ä¸ªå­ç±»ï¼Œé…ç½®æ•°æ®æºå³å¯ã€‚</p>
<p>çœ‹å®Œäº†æœ¬ç¯‡æ–‡ç« ï¼Œæ˜¯ä¸æ˜¯è§‰å¾—åšè¿™æ ·é•‚ç©ºçš„æ–°æ‰‹æŒ‡å¼•ç‰¹åˆ«ç®€å•å‘¢ã€‚</p>
<p><strong>æ‰©å±•é˜…è¯»</strong></p>
<p><img src="http://upload-images.jianshu.io/upload_images/545662-6fc6b7af39a0ca66.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="A8CE916E-AE02-46C1-85C1-C44EDCE8ABEC"></p>
<p>æ­¤å¤„çš„å±•ç¤ºè¿˜æœ‰ä¸€ç‚¹å°å‘ï¼Œé‚£å°±æ˜¯è¿™æ˜¯ä¸€ä¸ªè¡¨æ ¼ã€‚åˆšå¼€å§‹è¿™ä¸ªè¡¨æ ¼å¹¶æ²¡æœ‰æ˜¾ç¤ºè¿™ä¸ª <code>cell</code>ã€‚å½“æ»‘åŠ¨å‡ºç°æ‰å±•ç¤ºå‡ºæ¥ã€‚</p>
<p>è¿™æ ·å°±è¦è¿™æ ·åš</p>
<ul>
<li>æ»‘åŠ¨åœæ­¢æˆ–è€…æ‹–åŠ¨åœæ­¢</li>
<li>æ»‘åŠ¨ <code>Settings</code>çš„ <code>Cell</code>çš„åº•éƒ¨ä¸€å®šè¦å‡ºå¯è§†èŒƒå›´å¤§äº20</li>
<li>ç”¨å˜é‡æ ‡è®° å‡ºç°ä¹‹åæ¥å›æ»šåŠ¨ä¸ä¼šå†æ¬¡å‡ºç°</li>
</ul>
<p>è¿™æ ·æ‰èƒ½ä¸ä¼šæœ‰æ¥å›å¿«é€Ÿæ»šåŠ¨ æˆ–è€… åªéœ²å‡ºä¸€ç‚¹ å°±æ˜¾ç¤ºå‡ºæ¥çš„ BUG</p>
 </p>
                      </div>
                  </div>

                  <div class="row">
                      <div class="col-md-12 animate-box">
                          
                              <div class="next-post">
                                  <div class="next">ä¸‹ä¸€ç¯‡</div>
                                  <a href="https://joserccblog.github.io/post/2017-11-27-uiviewæ·»åŠ åˆ°keywindowä¸Šé¢è‡ªåŠ¨ä¼šè¢«-release">
                                      <h3 class="post-title">
                                          UIViewæ·»åŠ åˆ°KeyWindowä¸Šé¢è‡ªåŠ¨ä¼šè¢« Release
                                      </h3>
                                  </a>
                              </div>
                          
                      </div>
                  </div>

                  <div class="row">
                      <div class="col-md-12 animate-box">
                          
                              

                              
                                  <div id="disqus_thread"></div>
                              
                          
                      </div>
                  </div>
              </div>

          </article>
      </div>
  </div>

    
<footer id="fh5co-footer">
  <p>Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a></p>
</footer>


    <!-- jQuery -->
<script src="https://joserccblog.github.io/media/scripts/_vendors/jquery.min.js"></script>
<!-- jQuery Easing -->
<script src="https://joserccblog.github.io/media/scripts/_vendors/jquery.easing.1.3.js"></script>
<!-- Bootstrap -->
<script src="https://joserccblog.github.io/media/scripts/_vendors/bootstrap.min.js"></script>
<!-- Waypoints -->
<script src="https://joserccblog.github.io/media/scripts/_vendors/jquery.waypoints.min.js"></script>
<!-- Main JS -->
<script src="https://joserccblog.github.io/media/scripts/_vendors/main.js"></script>
<!-- Md5 Min JS -->
<script src="https://joserccblog.github.io/media/scripts/_vendors/md5.min.js"></script>

<script type="application/javascript">
    hljs.initHighlightingOnLoad();
</script>



    

    
        <script src="https://unpkg.com/disqusjs@1.1/dist/disqus.js"></script>
        <script>

            var options = {
                shortname: 'josercc',
                apikey: 'DBJHHPsqZBT5EUYFyQmorAozkwxTDoySOnd4bmdt9G29YFySUFhFE6SLZrSCHee4',
            }
            if ('') {
                options.api = ''
            }
            var dsqjs = new DisqusJS(options)

        </script>
    




  </body>
</html>
